<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
	<link rel="stylesheet" href="index.css">
	<title>jsPDF</title>
</head>
<body>

	<div class="canvas" id="canvas"></div>

	<section>
<form method="POST" role="form" class="form-inline" action="{% url 'impa:imp_new' %}">
            <div class="col-xl-12 col-md-12 mb-12">
                <div class="card border-left-warning shadow h-100 py-2">
                <div class="card border-left-success shadow h-100 py-2">
                    <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                            </div>
                            <div class="dropdown-divider"></div> 
                            <div class="row">
                              <p>
                                    <label for="id_fecha">Fecha:</label>
                                    <input type="text" name="fecha" class="form-control" required id="id_fecha">
                              </p>
                                <div class="ing_guiGrid col2">
                                  <p>
                                    <label for="id_codigo_cliente">Codigo Cliente:</label>
                                    <input type="text" name="codigo_cliente" maxlength="8" class="form-control" required id="id_codigo_cliente">
                                  </p>
                                  <p>
                                    <label for="id_remitente">Remitente:</label>
                                    <input type="text" name="remitente" maxlength="200" class="form-control" required id="id_remitente">
                                  </p>
                                </div>
                                <div class="ing_guiGrid col1">
                                  <p>
                                    <label for="id_dirrem">Direccion Remitente:</label>
                                    <input type="text" name="dirrem" maxlength="300" class="form-control" required id="id_dirrem">
                                  </p>
                                </div>
                                <div class="ing_guiGrid col5">
                                  <p>
                                    <label for="id_tel">Telefono:</label>
                                    <input type="text" name="tel" maxlength="9" class="form-control" required id="id_tel">
                                  </p>
                                  <p>
                                    <label for="id_zona">Zona:</label>
                                    <input type="text" name="zona" maxlength="2" class="form-control" required id="id_zona">
                                  </p>
                                  <p>
                                    <label for="id_muni">Municipio:</label>
                                    <input type="text" name="muni" maxlength="50" class="form-control" required id="id_muni">
                                  </p>
                                  <p>
                                    <label for="id_origen">Origen:</label>
                                    <input type="text" name="origen" maxlength="50" class="form-control" required id="id_origen">
                                  </p>
                                  <p>
                                    <label for="id_ruta">Ruta:</label>
                                    <input type="text" name="ruta" maxlength="3" class="form-control" required id="id_ruta">
                                  </p>
                                </div>
                                <div class="ing_guiGrid col2">
                                  <p>
                                    <label for="id_codigo_desti">Codigo Dest:</label>
                                    <input type="text" name="codigo_desti" maxlength="8" class="form-control" id="id_codigo_desti">
                                  </p>
                                  <p>
                                    <label for="id_destinatario">Destinatario:</label>
                                    <input type="text" name="destinatario" maxlength="100" class="form-control" id="id_destinatario">
                                  </p>
                                </div>
                                <div class="ing_guiGrid col1">
                                  <p>
                                    <label for="id_dirdes">Direccion Dest:</label>
                                    <input type="text" name="dirdes" maxlength="300" class="form-control" id="id_dirdes">
                                  </p>
                                </div>
                                <div class="ing_guiGrid col5">
                                  <p>
                                    <label for="id_teldes">Telefono:</label>
                                    <input type="text" name="teldes" maxlength="9" class="form-control" id="id_teldes">
                                  </p>
                                  <p>
                                    <label for="id_zonades">Zona:</label>
                                    <input type="text" name="zonades" maxlength="2" class="form-control" id="id_zonades">
                                  </p>
                                  <p>
                                    <label for="id_munides">Municipio:</label>
                                    <input type="text" name="munides" maxlength="50" class="form-control" id="id_munides">
                                  </p>
                                  <p>
                                    <label for="id_destino">Destino:</label>
                                    <input type="text" name="destino" maxlength="50" class="form-control" id="id_destino">
                                  </p>
                                  <p>
                                    <label for="id_rutades">Ruta:</label>
                                    <input type="text" name="rutades" maxlength="3" class="form-control" id="id_rutades">
                                  </p>
                                </div>
                                <div class="ing_guiGrid">
                                  <p>
                                    <label for="id_fpago">Forma de pago:</label>
                                    <input type="text" name="fpago" maxlength="8" class="form-control" id="id_fpago">
                                  </p>
                                </div>
                                <div class="ing_guiGrid col1 alt1">
                                  <p>
                                    <label for="id_numini">Numero Inicial:</label>
                                    <input type="text" name="numini" maxlength="6" class="form-control" required id="id_numini">
                                  </p>
                                  <p>
                                    <label for="id_numfin">Numero Final:</label>
                                    <input type="text" name="numfin" maxlength="6" class="form-control" required id="id_numfin">
                                  </p>
                                  <p>
                                    <label for="id_totalimp">Total Guías A Imprimir:</label>
                                    <input type="text" name="totalimp" maxlength="6" class="form-control" required id="id_totalimp">
                                  </p>
                                </div>
                            <div class="dropdown-divider"></div>
                            <div class="row">
                                <div class="col">
                                    <button type="submit" class="btn btn-danger print"><span class="fa fa-print"></span> Imprimir</button>
                                    <!--<a href="{% url 'link:departamento_list' %}" class="btn btn-success"><span class="fa fa-undo"></span>Cancelar</a>-->
                                    <button type="button" class="btn btn-success" onclick="cerrar_modal()"><i class="fas fa-window-close"></i>
                                     Salir   
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
            </div>
        </form>
	</section>

	<script>
		// DATE
		var today = new Date();
		var day = today.getDate();
		var month = today.getMonth() + 1;
		var year = today.getFullYear();
		var hour = today.getHours();
		var minutes = today.getMinutes();

		var numInicial;
		var numFinal;

		let print = $('.print');

		$("form").submit(function (e) {
			numInicial = parseInt($('#id_numini').val());
			numFinal = parseInt($('#id_numfin').val());

		    e.preventDefault();

		    imprSelec('canvas');
		});

		function imprSelec(nombre) {
			var ficha = document.getElementById(nombre)
			var ventana = window.open(' ', 'popimpr');
			ventana.document.write('<html><head><title>' + document.title + '</title>');
			ventana.document.write('<link rel="stylesheet" href="print.css">'); //Aquí agregué la hoja de estilos
			ventana.document.write('</head><body >');
			//ventana.document.write('<div class="canvas"></div>')
			for(var i = numInicial; i <= numFinal; i++){
				ventana.document.write(
					ficha.innerHTML =`
						<div class="guia">
							<div class="formapago">
								<p class="">${$('#id_fpago').val()}</p>
							</div>
							<div class="datosRemitente">
								<p class="remitente">${$('#id_remitente').val()}</p>
								<p class="dirRemitente">${$('#id_dirrem').val()}</p>
								<p class="telRemitente">${$('#id_tel').val()}</p>
								<p class="origen">${$('#id_origen').val()}</p>
							</div>
							<div class="datosDestinatario">
								<p class="destinatario">${$('#id_destinatario').val()}</p>
								<p class="dirDestinatario">${$('#id_dirdes').val()}</p>
								<p class="telDestinatario">${$('#id_teldes').val()}</p>
								<p class="destino">${$('#id_destino').val()}</p>
							</div>
							<div class="codigoCliente">
								<p>${$('#id_codigo_cliente').val()}</p>
							</div>
							<div class="horario">
								<p class="dia">${day}</p>
								<p class="mes">${month}</p>
								<p class="year">${year}</p>
								<p class="hora">${hour}:${minutes}</p>
							</div>
						</div>
						<div class="break"></div>
					`
				);
			}
			ventana.document.write('</body></html>');
			ventana.document.close();
			setTimeout(()=>{
				ventana.print( );
			}, 100)
		}
	</script>
</body>
</html>
